---
title: Reviews Rating
---

The following documentation goes through an example implementation of a review rating platform for the food service industry on Sui. By leveraging blockchain to allow reviewers to own and monetize their feedback, the on-chain platform ensures transparency and temper-proof ratings.

## Personas

There are four actors in the typical workflow of the reviews rating example.  

```mermaid
sequenceDiagram
  Service ->> Dashboard: Add service to dashboard.
  Service ->> User: Send proof of experience.
  User ->> Service: Send review
  Service ->> User: Send reward
  Service ->> Moderator: Add as a service moderator
  Moderator ->> Service: Remove abused review
```

### Service owners

Service owners are entities like restaurants that list their services on the platform. Service owners allocate a specific amount of SUI as a reward pool. Assets from the pool are used to provide rewards for honest reviews. A Proof of Experience (PoE) NFT confirms the reviewer used the service, which they burn to provide a verified review. Service owners can provide their customers with unique identifiers, perhaps using QR codes, to identify individual reviewers.

### Reviewers

Reviewers are consumers of services that use the review system. Reviewers provide feedback in the form of comments that detail specific aspects of the service as well as a star rating to inform others. The reviews are rated, with the most effective reviews getting the highest rating. Service owners award the 10 highest rated reviews for their service. 

### Review readers

Review readers access reviews to make informed decisions on selecting services. Readers rate reviews by casting up or down votes. The review readers' ratings are factored into the algorithm that rates the reviews, with the authors of the highest-rated reviews getting awarded. 

### Moderator

The moderator monitors content of the reviews and can delete any reviews that contain inappropriate content.

## How reviews are rated

The reviews are rated (scored) on-chain using following criteria
- Intrinsic score (IS)
  - Length of content
- Extrinsic score (ES)
  - Number of votes received
- Verification multiplier (VM)
  - Reviews with PoE get a multiplier to improve rating

```
Total Score = (IS + ES) * VM
```

## Backend

There are several modules that create the backend logic for the example. 

### dashboard.move

The `dashboard.move` module defines the `Dashboard` struct that is used to group services.

```move
struct Dashboard has key, store {
  id: UID,
  set: VecSet<ID>,
  service_type: String
}
```

The services are grouped by attributes, which can be cuisine type, geographical location, operating hours, google maps ID, and so on. To keep it basic, the example stores only `service_type` (for example, fast food, Chinese, Italian).

### service.move

This module defines the `Services` struct, which service owners manage.

```move
struct Service has key, store {
  id: UID,
  reward_pool: Balance<SUI>,
  reward: u64,
  reviews: MultiMap<ID>,
  moderators: VecSet<address>,
  overall_rate: u64,
  name: String
}
```

All the submitted reviews are stored in `reviews` field, which has `MultiMap<ID>` type. The [multimap module](#multimap) defines the type. 

The `reward_pool` and `reward` fields store the available reward information.  

### multimap.move {#multimap}

`MultiMap` is an implementation of the `multimap` data structure (https://en.wikipedia.org/wiki/Multimap), which keeps all the reviews sorted. Using `MultiMap`, all the reviews are ordered by rating, with the highest rated reviews coming first.

```move
struct MultiMap<K: copy> has copy, drop, store {
  contents: vector<Entry<K>>,
}
```

### review.move

This module defines the `Review` struct.

```move
struct Review has key, store {
  id: UID,
  owner: address,
  service_id: ID,
  content: String,
  // is
  len: u64,
  // es
  votes: u64,
  time_issued: u64,
  // vm: proof of experience
  has_poe: bool,
  // total score
  ts: u64,
  overall_rate: u8,
}
```

In addition to the content of a review, all the elements that are required to compute total score are stored in a `Review` object.

## Frontend
The frontend module is written in React, and is structured to provide a responsive user experience for interacting with a review rating platform.
On the [`page` component](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/page.tsx), a user can be logged in as a `SERVICE OWNER` or a `USER`.

### Directories structure

The frontend is a NextJS project, that follows the NextJS App Router [project structure](https://nextjs.org/docs/app/building-your-application/routing).
The main code of the frontend lies under the [app/src/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/) directory.
The main sub-directories are:
  - [app/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/): The main code of the pages and the global styles.
  - [components/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/components): The reusable components of the app, organized in sub-directories.
  - [hooks/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/hooks): The custom hooks used in the app.
  - [serviceOwner/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/serviceOwner): The pages for `SERVICE OWNER`.
  - [types/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/types): The types/interfaces used in the app.
  - [user/](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/user): The pages for `USER`.

### Components and custom hooks for state management

- **Custom Hooks:** To keep the code as structured as possible, multiple custom hooks are utilized to manage the list of reviews associated with a service. The [useGetReviews](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/hooks/useGetReviews.ts)
custom hook encapsulates the service, exposing all the required information (with fields such as `nameOfService`, `listOfReviews`, `listOfStars`) to display the reviews in a table.
Multiple additional custom hooks, such as [useDashboardCreation](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/hooks/useDashboardCreation.ts), and [useServiceReview](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/hooks/useServiceReview.ts) are encapsulating their own piece of state and logic to make the code readable and maintainable.

- **Component for Adding a New Review:** The [AddReview](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/components/review/AddReview.tsx) component is implemented to facilitate the creation of a new review. It is rendered by the [servicePage](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/service/[id]/page.tsx) to collect a review entry from a `USER` and uses the `signAndExecuteTransactionBlock` function of the [useWalletKit] hook to execute the transaction.

- **Proof of Experience Generation:** Proof of Experience(PoE) is an NFT that is minted by `SERVICE OWNER` for customers after they dine at the restaurant; customers can, then, burn the PoE to write a high-rated review later. Minting an NFT is facilitated by the [ownedServicePage](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/serviceOwner/ownedServices/page.tsx) component. This component is using the [useServicePoEGeneration](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/hooks/useServicePoeGeneration.ts) custom hook.

- **Delete a Review:** The moderator can delete a review that contain inappropriate content. [moderatorRemovePage](https://github.com/MystenLabs/reviews-ratings-poc/blob/main/app/src/app/user/moderator/remove/page.tsx) component is used to delete a review.
