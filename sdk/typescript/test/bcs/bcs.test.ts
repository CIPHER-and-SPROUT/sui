import { MoveBCS as BCS } from '../../src/bcs';
import { Base64DataBuffer as B64 } from '../../src';
import { BN } from 'bn.js';

describe('Move BCS', () => {
    it('should de/ser primitives: u8', () => {
        expect(BCS.de(BCS.U8, new B64('AQ==').getData())).toEqual(new BN(1));;
        expect(BCS.de('u8', new B64('AA==').getData())).toEqual(new BN(0));;
    });

    it('should de/ser custom objects', () => {
        BCS.registerStructType('Coin', {
            value: BCS.U64,
            owner: BCS.STRING,
            is_locked: BCS.BOOL
        });

        const rustBcs = new B64('gNGxBWAAAAAOQmlnIFdhbGxldCBHdXkA');
        const expected = {
            owner: 'Big Wallet Guy',
            value: new BN('412412400000', 10),
            is_locked: false
        };

        const serBytes = BCS.ser('Coin', expected).toBytes();

        expect(BCS.de('Coin', rustBcs.getData())).toEqual(expected);
        expect(new B64(serBytes).toString()).toEqual(rustBcs.toString());
    });

    it('should de/ser vectors', () => {
        BCS.registerVectorType('vector<u8>', 'u8');

        // Rust-BCS generated vector with 1000 u8 elements (FF)
        const sample = new B64(largeBCSVec());

        // deserialize data with JS
        const deserialized = BCS.de('vector<u8>', sample.getData());

        // create the same vec with 1000 elements
        let arr = Array.from(Array(1000)).map(() => 255);
        const serialized = BCS.ser('vector<u8>', arr).toBytes();

        expect(deserialized.length).toEqual(1000);
        expect(new B64(serialized).toString()).toEqual(largeBCSVec());
    });
});


function largeBCSVec(): string {
    return '6Af/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////';
}
